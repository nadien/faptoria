describe('escaped fragment utilities', function () {

    var utilities = require('../src/escaped-fragment-utilities');

    describe('isEscapedRequest', function () {
        it('should return true if the request is escaped even if empty', function () {
            var fakeRequest = {
                query: {
                    _escaped_fragment_: ''
                }
            };

            expect(utilities.isEscapedRequest(fakeRequest)).toBeTruthy();
        });

        it('should return true if the request is escaped', function () {
            var fakeRequest = {
                query: {
                    _escaped_fragment_: 'liu'
                }
            };

            expect(utilities.isEscapedRequest(fakeRequest)).toBeTruthy();
        });

        it('should return false if the request is not escaped', function () {
            var fakeRequest = {
                query: {}
            };

            expect(utilities.isEscapedRequest(fakeRequest)).toBeFalsy();
        });
    });

    describe('unescapeRequest', function () {
        it('should recreate a pretty url from an ugly url', function () {
            var fakeRequest = {
                protocol: 'http',
                headers: {
                    host: 'localhost'
                },
                query: {
                    _escaped_fragment_: 'home',
                    q: 'awesome query'
                },
                originalUrl: '/?q=awesome query',
                path: '/'
            };
            var expectedUrl = 'http://localhost/#!home?q=awesome query';

            expect(utilities.unescapeRequest(fakeRequest)).toEqual(expectedUrl);
        });
    });
});
